\section{Test Case SPS-DARK-150: Detector Dark}

\subsection{Description}

Take a 10 seconds dark on a given detector, check that the file is created correctly, minimal check on fits header, data correctly tracked on opDB.
\begin{itemize}
\item \texttt{For duplicate keys}
\item \texttt{hdr['DATA-TYP']==DARK}
\item \texttt{hdr['EXPTIME']==10.0}
\item \texttt{sequence\_type from sps\_sequence == darks}
\item \texttt{pfs\_visit\_id from visit\_set match hdr['W\_VISIT']}
\item \texttt{exp\_type from sps\_visit match dark}
\item \texttt{exptime from sps\_exposure inner join sps\_visit match 10.0}
\item \texttt{sps\_module\_id from sps\_exposure inner join sps\_visit inner join sps\_camera match hdr['W\_SPMOD']}
\item \texttt{arm\_num from sps\_exposure inner join sps\_visit inner join sps\_camera match hdr['W\_ARM']}

\end{itemize}

Check that the operations database is correctly populated.

\subsection{Pass/Fail Condition(s)}

\begin{description}
\item [Pass] filepath and fits header keys be generated and command should finish with `\texttt{test=dark-cam,OK}', 
and that the \texttt{sps\_exposure} table is correctly populated, 
with the field \texttt{pfs\_visit\_id} set to the appropriate visit, \texttt{exptime}, 
set to the exposure time (10 seconds), and the \texttt{time\_exp\_start} \texttt{time\_exp\_end} set appropriately.

\item [Fail] If an exception is raised `\texttt{test=dark-cam,FAILED}' will be generated with its full trace, 
or that the operations database is not correctly populated.


\end{description}

\subsection{Hardware constraints}

\begin{enumerate}
    \item SPS RACK powered up
    \item \acrshort{BEE} powered up.
    \item Fee powered up
\end{enumerate}

\subsection{Initial conditions}

ccdActor and testsActor started

\subsection{Procedure}

\begin{enumerate}
    \item testsActor : send dark test command: \texttt{tests dark cam=r1} .
    \item wait for the command to end.
\end{enumerate}

\subsection{Additional Notes}
None.
